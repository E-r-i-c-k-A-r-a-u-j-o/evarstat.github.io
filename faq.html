<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="Content-Language" content="es">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Foro | EVAR Stat</title>
  <meta name="description" content="EVAR Stat es un software estad칤stico moderno y profesional para an치lisis de datos, dise침ado para investigadores, docentes y estudiantes.">
  <meta name="keywords" content="EVAR Stat, software estad칤stico, an치lisis de datos, tablas, gr치ficos, exportar PDF, Word, SPSS, Jamovi, tesis, investigaci칩n">
  <meta name="author" content="Erick Araujo">
  <meta name="robots" content="index, follow">

  <!-- Canonical URL (ajusta seg칰n la p치gina) -->
  <link rel="canonical" href="https://evarstat.com/faq.html" />

  <!-- Open Graph -->
  <meta property="og:title" content="EVAR Stat - Software Estad칤stico" />
  <meta property="og:description" content="Software estad칤stico moderno para an치lisis de datos, ideal para estudiantes, investigadores y empresas." />
  <meta property="og:image" content="https://evarstat.com/evarstat-estadistica.png" />
  <meta property="og:url" content="https://evarstat.com/faq.html" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="EVAR Stat" />
  <meta property="og:locale" content="es_ES" />

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="EVAR Stat - Software Estad칤stico" />
  <meta name="twitter:description" content="EVAR Stat es un software estad칤stico profesional para an치lisis de datos, con resultados exportables." />
  <meta name="twitter:image" content="https://evarstat.com/evarstat-estadistica.png" />

  <!-- Sitemap y robots -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://evarstat.com/sitemap.xml" />
  <link rel="robots" href="https://evarstat.com/robots.txt" />

  <!-- Favicon e iconos -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="evarstat-logo.png">
  <link rel="shortcut icon" href="https://evarstat.com/favicon.ico" type="image/x-icon">

  <!-- Google Analytics (opcional) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4DGWQHFF2H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4DGWQHFF2H');
  </script>

<!-- 游닂 Datos estructurados de preguntas frecuentes -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "쯈u칠 es EVAR Stat?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "EVAR Stat es un software estad칤stico moderno dise침ado para an치lisis de datos, visualizaci칩n y modelado predictivo."
      }
    },
    {
      "@type": "Question",
      "name": "쮼VAR Stat es gratis?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "S칤, EVAR Stat es gratuito tanto para estudiantes, docentes e investigadores."
      }
    },
    {
      "@type": "Question",
      "name": "쮼n qu칠 sistemas operativos funciona EVAR Stat?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "EVAR Stat est치 disponible para Windows, y pr칩ximamente para macOS y Linux."
      }
    },
    {
      "@type": "Question",
      "name": "쯈u칠 diferencia a EVAR Stat de SPSS o Jamovi?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "EVAR Stat combina la potencia anal칤tica de SPSS con la visualizaci칩n moderna de Jamovi y la potencia de Power BI ofreciendo una experiencia m치s intuitiva y r치pida."
      }
    }
  ]
}
</script>

  <!-- Estilos -->
  <link rel="stylesheet" href="estilos.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />

  <style>
    body {
      background: linear-gradient(120deg, #e3f2fd 0%, #f5f7fa 100%);
    }
    .faq-section {
      max-width: 800px;
      margin: 48px auto 32px auto;
      background: transparent; /* antes: #fff */
      border-radius: 0;         /* antes: 18px */
      box-shadow: none;         /* antes: 0 2px 16px rgba(...) */
      padding: 0 0 2rem 0;      /* opcional: reduce relleno exterior */
    }
    /* NUEVO: tarjeta independiente para identidad */
    .identity-card{
      max-width: 800px; /* antes: 900px */
      width: 100%;
      margin: 28px auto 0 auto;
      background: #fff;
      border-radius: 22px;
      padding: 1.6rem 1.2rem;
      border: 1px solid rgba(25,118,210,.06);
      box-shadow:
        0 2px 12px rgba(25,118,210,.10),
        0 10px 30px rgba(25,118,210,.10);
      position: relative;
      overflow: hidden;
    }
    /* Halo sutil alrededor de la tarjeta */
    .identity-card::before{
      content:"";
      position:absolute;
      inset:-24px;
      border-radius:28px;
      background: radial-gradient(120% 60% at 50% 0%,
                  rgba(144,202,249,.35), rgba(187,222,251,.22) 40%,
                  rgba(255,255,255,0) 70%);
      filter: blur(8px);
      z-index:-1;
      pointer-events:none;
    }

    .identity-box{
      display:flex; flex-direction:column; align-items:center;
      margin:0; background:transparent; border-radius:12px; padding:0;
      text-align:center;
    }
    .identity-info{ color:#111; font-weight:700; margin-bottom:.4rem; }
    .identity-box .small{ color:#555; font-size:.97rem; margin-bottom:.6rem; }

    .identity-box input[type="email"]{
      padding:10px 12px; border-radius:8px; border:1px solid #c5d9f1;
      font-size:1rem; width:280px; max-width:100%; background:#f8fafc;
      margin-bottom:.6rem;
    }
    .identity-box input[type="email"]:focus{
      outline:0; border-color:#1976d2; box-shadow:0 0 0 3px rgba(25,118,210,.12);
    }
    .identity-box button{
      background:#1976d2; color:#fff; border:0; border-radius:10px;
      padding:.6rem 1.1rem; font-weight:600; cursor:pointer; transition:background .2s;
    }
    .identity-box button:hover{ background:#0d47a1; }

    @media (max-width:600px){
      .identity-card{ margin:18px auto 0; border-radius:18px; padding:1.1rem .9rem; }
    }

    .faq-title {
      text-align: center;
      font-size: 2.2rem;
      color: #111; /* Cambiado de #1976d2 a negro */
      margin-bottom: 2rem;
      font-weight: 700;
    }
    .identity-box input[type="email"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #bbb;
      font-size: 1rem;
      margin-bottom: 10px;
      width: 260px;
      max-width: 100%;
    }
    .identity-box button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
      margin-bottom: 6px;
      transition: background 0.2s;
    }
    .identity-box button:hover {
      background: #0d47a1;
    }
    .identity-info {
      color: #111; /* Cambiado de #1976d2 a negro */
      font-weight: 600;
      margin-bottom: 8px;
    }
    .identity-box .small {
      color: #555;
      font-size: 0.97rem;
      margin-bottom: 8px;
      text-align: center;
    }
    .faq-search-box {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 0 !important;
      width: 100%;
    }
    .faq-search-box input[type="text"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      min-width: 100px;      /* Antes: 120px */
      max-width: 150px;     /* Antes: 180px */
      width: 150px;         /* Fija el ancho */
      background: #f8fafc;
    }
    .faq-search-box button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 70px;
    }
    .faq-search-box button:hover {
      background: #0d47a1;
    }
    .faq-form {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .faq-form input[type="text"] {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      min-width: 180px;
    }
    .faq-form button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 18px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .faq-form button[disabled] {
      background: #b0bec5;
      cursor: not-allowed;
    }
    .faq-form button:hover:enabled {
      background: #0d47a1;
    }
    .faq-list { margin-top: 10px; }
    .faq-item {
      background: #fff;
      border-radius: 10px;
      margin-bottom: 22px;
      padding: 20px 18px 14px 18px;
      box-shadow: 0 2px 12px #1976d220;
      border-left: 5px solid #1976d2;
      transition: box-shadow 0.2s;
    }
    .faq-item:hover { box-shadow: 0 4px 24px #1976d230; }
    .faq-question-text {
      font-weight: 700;
      font-size: 1.15rem;
      color: #000000;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .faq-question-meta {
      color: #888;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }
    .faq-answers { margin-top: 10px; }
    .faq-answer {
      background: transparent !important;
      border-left: 3px solid #1976d2;
      color: #111;
      padding: 10px 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      position: relative;
    }
    .faq-answer-meta {
      color: #888;
      font-size: 0.92rem;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 8px;
    }
    .faq-answer-form {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .faq-answer-form input[type="text"] {
      flex: 1;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #bbb;
      font-size: 1rem;
      min-width: 120px;
    }
    .faq-answer-form button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .faq-answer-form button[disabled] {
      background: #b0bec5;
      cursor: not-allowed;
    }
    .faq-answer-form button:hover:enabled {
      background: #0d47a1;
    }
    .delete-btn {
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 10px;
      font-size: 0.95rem;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #b71c1c;
    }
    @media (max-width: 600px) {
      .faq-section { padding: 1.2rem 0.5rem; }
      .faq-title { font-size: 1.3rem; }
      .faq-form, .faq-answer-form, .faq-search-box { flex-direction: column; gap: 6px; }
      .faq-question-text { flex-direction: column; align-items: flex-start; gap: 6px; }
    }
    .faq-search-fixed {
      position: fixed;
      top: 24px;
      right: 32px;
      z-index: 20;
      max-width: 340px;
      width: auto;
      box-sizing: border-box;
      margin-left: 16px;
    }
    @media (max-width: 900px) {
      .faq-search-fixed {
        position: static;
        margin: 10px auto 0 auto;
        display: flex;
        justify-content: flex-end;
        width: 95%;
        max-width: 100%;
      }
      .faq-search-box {
        width: 100%;
        max-width: 100%;
        padding: 8px 4px;
      }
    }

    .highlight-search {
      background: #ffe082;
      color: #222;
      border-radius: 3px;
      padding: 0 2px;
    }

    /* Agrega esto al final del <style> */
    .fab-question {
      position: fixed;
      bottom: 32px;
      right: 32px;
      background: #1976d2;
      color: #fff;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      box-shadow: 0 4px 16px #1976d250;
      cursor: pointer;
      z-index: 100;
      border: none;
      transition: background 0.2s;
    }
    .fab-question:hover { background: #0d47a1; }
    @media (max-width:600px) {
      .fab-question { bottom: 16px; right: 16px; }
    }

    .badge-user {
      background: #1976d2;
      color: #fff;
      border-radius: 12px;
      padding: 2px 10px;
      font-size: 0.98rem;
      font-weight: 500;
      margin-left: 6px;
      display: inline-block;
    }

    .faq-item, .faq-answer {
      animation: fadeInUp 0.5s;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px);}
      to { opacity: 1; transform: translateY(0);}
    }

    /* Tarjetas para cada hilo de preguntas */
    #faq-list{
      max-width: 800px;
      margin: 18px auto 32px;
      display: grid;
      gap: 14px;
    }
    #faq-list > *{
      background:#fff;
      border-radius:16px;
      padding:1rem 1.1rem;
      box-shadow:0 2px 16px rgba(25,118,210,.08);
      border:1px solid rgba(25,118,210,.06);
      transition: box-shadow .2s ease;
    }
    #faq-list > *:hover{
      box-shadow:0 6px 22px rgba(25,118,210,.12);
    }
    /* Entradas y bot칩n de respuesta dentro de cada hilo */
    #faq-list form{ display:flex; gap:.6rem; margin-top:.6rem; }
    #faq-list input[type="text"]{
      flex:1 1 auto;
      border:1.5px solid #c5d9f1;
      border-radius:10px;
      padding:.6rem .8rem;
      outline:0;
    }
    #faq-list input[type="text"]:focus{
      border-color:#1976d2;
      box-shadow:0 0 0 3px rgba(25,118,210,.12);
    }
    #faq-list button{
      background:#1976d2; color:#fff; border:0;
      border-radius:10px; padding:.55rem 1rem; font-weight:600; cursor:pointer;
    }
    #faq-list button:hover{ background:#0d47a1; }

    /* Responder sin negrita (igual a Publicar) */
    #faq-list .faq-answer-form button{
      font-weight:400;
    }
  </style>
</head>
<body>
  <!-- Agrega esto justo despu칠s de <body> -->
<header style="background: linear-gradient(90deg, #1976d2, #2196f3); padding: 22px 0; box-shadow: 0 2px 6px rgba(0,0,0,0.12);">
  <div style="display:flex; align-items:center; justify-content:center; gap:14px; max-width:900px; margin:0 auto;">
    
    <a href="index.html#inicio" style="display:flex; align-items:center;">
      <img 
        src="evarstat-logo.png" 
        alt="Logo de EVAR Stat - Volver al inicio"
        style="width:54px; height:54px; object-fit:contain; border-radius:12px; background:white; padding:6px; cursor:pointer;"
      >
    </a>

    <h1 style="margin:0; font-size:1.9rem; font-weight:700; line-height:1.2; color:#fff; letter-spacing:-0.5px;">
      Foro de la Comunidad EVAR Stat
    </h1>

  </div>
</header>
</div>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    // Configuraci칩n del proyecto
    const firebaseConfig = {
      apiKey: "AIzaSyD91BEba43lxr-kEqgibgRLyV9v-HiRaP4",
      authDomain: "evar-stat.firebaseapp.com",
      databaseURL: "https://evar-stat-default-rtdb.firebaseio.com", 
      projectId: "evar-stat",
      storageBucket: "evar-stat.firebasestorage.app",
      messagingSenderId: "697146517077",
      appId: "1:697146517077:web:55dfce33c4fde85b4b56dc",
      measurementId: "G-10JMJ80QFT"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function addFaqQuestion(question, email, callback) {
      db.ref('faq').push({ question, email, answers: [] }, callback);
    }

    function addFaqAnswer(faqId, text, email, callback) {
      db.ref(`faq/${faqId}/answers`).once('value', snap => {
        const answers = snap.val() || [];
        answers.push({ text, email });
        db.ref(`faq/${faqId}/answers`).set(answers, callback);
      });
    }

    function deleteFaqQuestion(faqId, callback) {
      db.ref(`faq/${faqId}`).remove(callback);
    }

    function deleteFaqAnswer(faqId, answerIdx, callback) {
      db.ref(`faq/${faqId}/answers`).once('value', snap => {
        const answers = snap.val() || [];
        answers.splice(answerIdx, 1);
        db.ref(`faq/${faqId}/answers`).set(answers, callback);
      });
    }

    function getFaqData(callback) {
      db.ref('faq').on('value', snapshot => {
        const data = snapshot.val() || {};
        const arr = Object.entries(data).map(([id, value]) => ({ id, ...value }));
        callback(arr.reverse());
      });
    }
  </script>
  <div class="faq-search-fixed">
    <div class="faq-search-box">
      <input type="text" id="faq-search" placeholder="Buscar palabra">
      <button id="faq-search-btn" type="button">Buscar</button>
    </div>
  </div>

  <!-- NUEVO: tarjeta propia para identidad -->
  <div class="identity-card">
    <div id="identity-box" class="identity-box"></div>
  </div>

  <div class="faq-section">
    <form id="faq-form" class="faq-form" autocomplete="off">
      <input type="text" id="faq-question" maxlength="300" placeholder="Escribe tu pregunta..." required>
      <button type="submit">Publicar</button>
    </form>
    <div id="faq-loading" style="text-align:center;display:none;background:transparent;">
      <img src="loader.gif" alt="Cargando..." style="width:200px;height:200px;vertical-align:middle;background:transparent;">
    </div>
    <div id="faq-list" class="faq-list"></div>
  </div>
  <script>
    function setCurrentUser(email) {
      localStorage.setItem('faqCurrentUser', email);
    }
    function getCurrentUser() {
      return localStorage.getItem('faqCurrentUser') || '';
    }
    function clearCurrentUser() {
      localStorage.removeItem('faqCurrentUser');
    }
    function getNameFromEmail(email) {
      if (!email) return '';
      return email.split('@')[0];
    }

    let searchTerm = "";
    let lastFaqData = []; // Mant칠n los datos actuales para b칰squedas y acciones

    function renderIdentityBox() {
      const box = document.getElementById('identity-box');
      const currentUser = getCurrentUser();
      if (currentUser) {
        box.innerHTML = `
          <div class="identity-info">Usuario: <b>${getNameFromEmail(currentUser)}</b></div>
          <div class="small">Tu correo se usa para identificar tus preguntas y respuestas.</div>
          <button id="change-identity-btn">Cambiar identidad</button>
        `;
        document.getElementById('change-identity-btn').onclick = function() {
          if (confirm('쯉eguro que deseas cambiar tu identidad?')) {
            clearCurrentUser();
            renderIdentityBox();
          }
        };
      } else {
        box.innerHTML = `
          <div class="small" style="margin-bottom:10px;">
            <b>Para participar debes ingresar tu correo.</b><br>
          </div>
          <input type="email" id="identity-email" placeholder="Tu correo electr칩nico" required>
          <button id="set-identity-btn">Usar este correo</button>
        `;
        document.getElementById('set-identity-btn').onclick = function() {
          const email = document.getElementById('identity-email').value.trim();
          if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            setCurrentUser(email);
            renderIdentityBox();
            renderFaq(lastFaqData); // <-- Agrega esta l칤nea
          } else {
            alert("Por favor, ingresa un correo v치lido.");
          }
        };
      }
    }

    // Renderizar preguntas y respuestas (con b칰squeda)
    function renderFaq(data) {
      lastFaqData = data; // Guarda los datos actuales para b칰squedas y acciones
      const faqList = document.getElementById('faq-list');
      const currentUser = getCurrentUser();
      let filteredData = data;

      // Filtrar por b칰squeda
      if (searchTerm.trim() !== "") {
        const term = searchTerm.trim().toLowerCase();
        filteredData = data.filter(item =>
          item.question.toLowerCase().includes(term) ||
          (item.answers && item.answers.some(a => a.text.toLowerCase().includes(term)))
        );
      }

      faqList.innerHTML = '';
      if (filteredData.length === 0) {
        faqList.innerHTML = '<div style="text-align:center;color:#888;"></div>';
        return;
      }
      filteredData.forEach((item, idx) => {
        // idxGlobal es el 칤ndice real en el array original
        const idxGlobal = data.indexOf(item);
        const div = document.createElement('div');
        div.className = 'faq-item';
        let deleteQuestionBtn = '';
        if (currentUser && item.email === currentUser) {
          deleteQuestionBtn = `<button class="delete-btn" data-type="question" data-id="${item.id}" title="Eliminar pregunta">&#128465;</button>`;
        }
        div.innerHTML = `
          <div class="faq-question-text">
            <img src="https://ui-avatars.com/api/?name=${getNameFromEmail(item.email)}&background=random&color=fff&rounded=true&size=32" alt="avatar" style="vertical-align:middle;margin-right:6px;">
            <span>${item.question}</span>
            ${deleteQuestionBtn}
          </div>
          <div class="faq-question-meta">Preguntado por <b>${item.email ? getNameFromEmail(item.email) : 'An칩nimo'}</b></div>
          <div class="faq-answers">
            ${(item.answers || []).map((a, aidx) => {
              let deleteAnswerBtn = '';
              if (currentUser && a.email === currentUser) {
                deleteAnswerBtn = `<button class="delete-btn" data-type="answer" data-id="${item.id}" data-aidx="${aidx}" title="Eliminar respuesta">&#128465;</button>`;
              }
              return `
                <div class="faq-answer">
                  <div class="faq-answer-meta">
                      <img src="https://ui-avatars.com/api/?name=${getNameFromEmail(a.email)}&background=random&color=fff&rounded=true&size=24" alt="avatar" style="vertical-align:middle;margin-right:4px;">
                      Respondido por <b>${a.email ? getNameFromEmail(a.email) : 'An칩nimo'}</b>
                    ${deleteAnswerBtn}
                  </div>
                  ${a.text}
                </div>
              `;
            }).join('')}
          </div>
          <form class="faq-answer-form" data-id="${item.id}">
            <input type="text" maxlength="300" placeholder="Responder..." required ${!currentUser ? "disabled" : ""}>
            <button type="submit" ${!currentUser ? "disabled" : ""}>Responder</button>
          </form>
        `;
        faqList.appendChild(div);
      });

      // Eliminar pregunta o respuesta
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = function(e) {
          e.preventDefault();
          const type = this.getAttribute('data-type');
          const id = this.getAttribute('data-id');
          if (type === "question") {
            if (confirm("쯉eguro que deseas eliminar esta pregunta y todas sus respuestas?")) {
              deleteFaqQuestion(id);
            }
          } else if (type === "answer") {
            const aidx = parseInt(this.getAttribute('data-aidx'));
            if (confirm("쯉eguro que deseas eliminar esta respuesta?")) {
              deleteFaqAnswer(id, aidx);
            }
          }
        };
      });

      // Formularios de respuesta
      document.querySelectorAll('.faq-answer-form').forEach(form => {
        form.onsubmit = function(e) {
          e.preventDefault();
          const id = this.getAttribute('data-id');
          const respuesta = this.querySelector('input[type="text"]').value.trim();
          const currentUser = getCurrentUser();
          let email = currentUser || '';
          if (!respuesta) {
            alert("Por favor, ingresa una respuesta.");
            return;
          }
          if (!email) return;
          addFaqAnswer(id, respuesta, email, function() {
            form.querySelector('input[type="text"]').value = '';
          });
        };
      });

      // Deshabilitar formulario de pregunta si no hay identidad
      document.getElementById('faq-question').disabled = !currentUser;
      document.querySelector('#faq-form button[type="submit"]').disabled = !currentUser;
    }

    // Publicar pregunta
    document.getElementById('faq-form').onsubmit = function(e) {
      e.preventDefault();
      const pregunta = document.getElementById('faq-question').value.trim();
      const currentUser = getCurrentUser();
      let email = currentUser || '';
      if (!pregunta) {
        alert("Por favor, ingresa una pregunta.");
        return;
      }
      if (!email) return;
      addFaqQuestion(pregunta, email, function() {
        document.getElementById('faq-question').value = '';
      });
    };

    // Resalta todas las coincidencias y hace scroll a la primera visible
    function highlightAndScrollToMatches(term) {
      if (!term) return;
      const faqList = document.getElementById('faq-list');
      const items = faqList.querySelectorAll('.faq-item');
      let firstMatch = null;

      items.forEach(item => {
        item.querySelectorAll('.highlight-search').forEach(span => {
          span.outerHTML = span.innerText;
        });

        const question = item.querySelector('.faq-question-text span');
        if (question && question.innerText.toLowerCase().includes(term.toLowerCase())) {
          highlightText(question, term);
          if (!firstMatch) firstMatch = question;
        }

        const answers = item.querySelectorAll('.faq-answer');
        answers.forEach(answer => {
          if (answer.innerText.toLowerCase().includes(term.toLowerCase())) {
            highlightText(answer, term);
            if (!firstMatch) firstMatch = answer;
          }
        });
      });

      if (firstMatch) {
        let parentItem = firstMatch.closest('.faq-item');
        if (parentItem) {
          parentItem.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      }
    }

    function highlightText(element, term) {
      const regex = new RegExp(`(${term})`, 'gi');
      element.innerHTML = element.innerText.replace(regex, '<span class="highlight-search">$1</span>');
    }

    document.getElementById('faq-search-btn').onclick = function() {
      searchTerm = document.getElementById('faq-search').value;
      renderFaq(lastFaqData);
      setTimeout(() => highlightAndScrollToMatches(searchTerm), 100);
    };
    document.getElementById('faq-search').addEventListener('keyup', function(e) {
      if (e.key === "Enter") {
        searchTerm = this.value;
        renderFaq(lastFaqData);
        setTimeout(() => highlightAndScrollToMatches(searchTerm), 100);
      }
    });

    // Inicializar
    renderIdentityBox();
    // Muestra el loader antes de cargar datos
    document.getElementById('faq-loading').style.display = 'block';
    getFaqData(function(data) {
      document.getElementById('faq-loading').style.display = 'none';
      renderFaq(data);
    });
  </script>
  <!-- Agrega esto antes de </body> -->
<button class="fab-question" title="Nueva pregunta" onclick="document.getElementById('faq-question').focus();">+</button>
</body>
</html>






