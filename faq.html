<!DOCTYPE html>
<html lang="es">
<head>
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- üîç SEO B√°sico -->
  <title>Foro - EVAR Stat</title>
  <link rel="stylesheet" href="estilos.css">
  <meta name="description" content="EVAR Stat es un software estad√≠stico moderno y profesional para an√°lisis de datos, dise√±ado para investigadores, docentes y estudiantes.">
  <meta name="keywords" content="EVAR Stat, software estad√≠stico, an√°lisis de datos, tablas, gr√°ficos, exportar PDF, Word, SPSS, Jamovi, tesis, investigaci√≥n">
  <meta name="author" content="Erick Araujo">
  <meta name="robots" content="index, follow">

  <!-- üîó Redes Sociales (Open Graph y Twitter) -->
  <meta property="og:title" content="EVAR Stat - Software Estad√≠stico" />
  <meta property="og:description" content="Software estad√≠stico moderno para an√°lisis de datos, ideal para estudiantes, investigadores y empresas." />
  <meta property="og:image" content="https://evarstat.com/evarstat-estadistica.png" />
  <meta property="og:url" content="https://evarstat.com/" />
  <meta property="og:type" content="website" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="EVAR Stat - Software Estad√≠stico" />
  <meta name="twitter:description" content="EVAR Stat es un software estad√≠stico profesional para an√°lisis de datos, con resultados exportables." />
  <meta name="twitter:image" content="https://evarstat.com/evarstat-estadistica.png" />

  <!-- üó∫Ô∏è Sitemap -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://evarstat.com/sitemap.xml" />

  <!-- üñºÔ∏è Iconos -->
  <link rel="icon" href="evarstat-logo.png" type="image/png" />
  <link rel="apple-touch-icon" href="img/icon-512.png" />

  <!-- üé® CSS -->
  <link rel="stylesheet" href="estilos.css" />
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />

  <!-- üìä Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4DGWQHFF2H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4DGWQHFF2H');
  </script>

  <style>
    body { background: #f5f7fa; }
    .faq-section {
      max-width: 800px;
      margin: 48px auto 32px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 16px rgba(25, 118, 210, 0.08);
      padding: 2.5rem 2rem;
    }
    .faq-title {
      text-align: center;
      font-size: 2.2rem;
      color: #1976d2;
      margin-bottom: 2rem;
      font-weight: 700;
    }
    .identity-box {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 24px;
      background: #e3f2fd;
      border-radius: 10px;
      padding: 18px 12px;
    }
    .identity-box input[type="email"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #bbb;
      font-size: 1rem;
      margin-bottom: 10px;
      width: 260px;
      max-width: 100%;
    }
    .identity-box button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 16px;
      font-size: 1rem;
      cursor: pointer;
      margin-bottom: 6px;
      transition: background 0.2s;
    }
    .identity-box button:hover {
      background: #0d47a1;
    }
    .identity-info {
      color: #1976d2;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .identity-box .small {
      color: #555;
      font-size: 0.97rem;
      margin-bottom: 8px;
      text-align: center;
    }
    .faq-search-box {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-bottom: 0 !important;
      width: 100%;
    }
    .faq-search-box input[type="text"] {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      min-width: 100px;      /* Antes: 120px */
      max-width: 150px;     /* Antes: 180px */
      width: 150px;         /* Fija el ancho */
      background: #f8fafc;
    }
    .faq-search-box button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 8px 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      min-width: 70px;
    }
    .faq-search-box button:hover {
      background: #0d47a1;
    }
    .faq-form {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .faq-form input[type="text"] {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 1rem;
      min-width: 180px;
    }
    .faq-form button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 18px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .faq-form button[disabled] {
      background: #b0bec5;
      cursor: not-allowed;
    }
    .faq-form button:hover:enabled {
      background: #0d47a1;
    }
    .faq-list { margin-top: 10px; }
    .faq-item {
      background: #f7f7f7;
      border-radius: 6px;
      margin-bottom: 18px;
      padding: 16px;
      box-shadow: 0 1px 4px rgba(25, 118, 210, 0.06);
    }
    .faq-question-text {
      font-weight: bold;
      color: #1976d2;
      margin-bottom: 4px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      word-break: break-word;
    }
    .faq-question-meta {
      color: #888;
      font-size: 0.95rem;
      margin-bottom: 8px;
    }
    .faq-answers { margin-top: 10px; }
    .faq-answer {
      background: #e3f2fd;
      border-radius: 4px;
      padding: 8px;
      margin-bottom: 6px;
      color: #222;
      font-size: 1rem;
      position: relative;
      word-break: break-word;
    }
    .faq-answer-meta {
      color: #888;
      font-size: 0.92rem;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .faq-answer-form {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .faq-answer-form input[type="text"] {
      flex: 1;
      padding: 6px;
      border-radius: 4px;
      border: 1px solid #bbb;
      font-size: 1rem;
      min-width: 120px;
    }
    .faq-answer-form button {
      background: #1976d2;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 6px 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .faq-answer-form button[disabled] {
      background: #b0bec5;
      cursor: not-allowed;
    }
    .faq-answer-form button:hover:enabled {
      background: #0d47a1;
    }
    .delete-btn {
      background: #e53935;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 4px 10px;
      font-size: 0.95rem;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #b71c1c;
    }
    @media (max-width: 600px) {
      .faq-section { padding: 1.2rem 0.5rem; }
      .faq-title { font-size: 1.3rem; }
      .faq-form, .faq-answer-form, .faq-search-box { flex-direction: column; gap: 6px; }
      .faq-question-text { flex-direction: column; align-items: flex-start; gap: 6px; }
    }
    .faq-search-fixed {
      position: fixed;
      top: 24px;
      right: 32px;
      z-index: 20;
      max-width: 340px;
      width: auto;
      box-sizing: border-box;
      margin-left: 16px;
    }
    @media (max-width: 900px) {
      .faq-search-fixed {
        position: static;
        margin: 10px auto 0 auto;
        display: flex;
        justify-content: flex-end;
        width: 95%;
        max-width: 100%;
      }
      .faq-search-box {
        width: 100%;
        max-width: 100%;
        padding: 8px 4px;
      }
    }

    .highlight-search {
      background: #ffe082;
      color: #222;
      border-radius: 3px;
      padding: 0 2px;
    }
  </style>
</head>
<body>
  <div class="faq-search-fixed">
    <div class="faq-search-box">
      <input type="text" id="faq-search" placeholder="Buscar palabra">
      <button id="faq-search-btn" type="button">Buscar</button>
    </div>
  </div>
  <div class="faq-section">
    <h1 class="faq-title">Preguntas de la Comunidad</h1>
    <div id="identity-box" class="identity-box"></div>
    <form id="faq-form" class="faq-form" autocomplete="off">
      <input type="text" id="faq-question" maxlength="300" placeholder="Escribe tu pregunta..." required>
      <button type="submit">Publicar</button>
    </form>
    <div id="faq-list" class="faq-list"></div>
  </div>
  <script>
    function setCurrentUser(email) {
      localStorage.setItem('faqCurrentUser', email);
    }
    function getCurrentUser() {
      return localStorage.getItem('faqCurrentUser') || '';
    }
    function clearCurrentUser() {
      localStorage.removeItem('faqCurrentUser');
    }
    function getFaqData() {
      return JSON.parse(localStorage.getItem('communityFaq') || '[]');
    }
    function setFaqData(data) {
      localStorage.setItem('communityFaq', JSON.stringify(data));
    }
    function getNameFromEmail(email) {
      if (!email) return '';
      return email.split('@')[0];
    }

    // Estado de b√∫squeda
    let searchTerm = "";

    // Renderizar identidad
    function renderIdentityBox() {
      const box = document.getElementById('identity-box');
      const currentUser = getCurrentUser();
      if (currentUser) {
        box.innerHTML = `
          <div class="identity-info">Identidad: <b>${getNameFromEmail(currentUser)}</b></div>
          <div class="small">Tu correo se usa para identificar tus preguntas y respuestas.</div>
          <button id="change-identity-btn">Cambiar identidad</button>
        `;
        document.getElementById('change-identity-btn').onclick = function() {
          if (confirm('¬øSeguro que deseas cambiar tu identidad?')) {
            clearCurrentUser();
            renderIdentityBox();
            renderFaq();
          }
        };
      } else {
        box.innerHTML = `
          <div class="small" style="margin-bottom:10px;">
            <b>Para participar debes ingresar tu correo.</b><br>
          </div>
          <input type="email" id="identity-email" placeholder="Tu correo electr√≥nico" required>
          <button id="set-identity-btn">Usar este correo</button>
        `;
        document.getElementById('set-identity-btn').onclick = function() {
          const email = document.getElementById('identity-email').value.trim();
          if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            setCurrentUser(email);
            renderIdentityBox();
            renderFaq();
          } else {
            alert("Por favor, ingresa un correo v√°lido.");
          }
        };
      }
    }

    // Renderizar preguntas y respuestas (con b√∫squeda)
    function renderFaq() {
      const faqList = document.getElementById('faq-list');
      const data = getFaqData();
      const currentUser = getCurrentUser();
      let filteredData = data;

      // Filtrar por b√∫squeda
      if (searchTerm.trim() !== "") {
        const term = searchTerm.trim().toLowerCase();
        filteredData = data.filter(item =>
          item.question.toLowerCase().includes(term) ||
          (item.answers && item.answers.some(a => a.text.toLowerCase().includes(term)))
        );
      }

      faqList.innerHTML = '';
      if (filteredData.length === 0) {
        faqList.innerHTML = '<div style="text-align:center;color:#888;"></div>';
        return;
      }
      filteredData.forEach((item, idx) => {
        // idxGlobal es el √≠ndice real en el array original
        const idxGlobal = data.indexOf(item);
        const div = document.createElement('div');
        div.className = 'faq-item';
        let deleteQuestionBtn = '';
        if (currentUser && item.email === currentUser) {
          deleteQuestionBtn = `<button class="delete-btn" data-type="question" data-idx="${idxGlobal}" title="Eliminar pregunta">&#128465;</button>`;
        }
        div.innerHTML = `
          <div class="faq-question-text">
            <span>${item.question}</span>
            ${deleteQuestionBtn}
          </div>
          <div class="faq-question-meta">Preguntado por <b>${item.email ? getNameFromEmail(item.email) : 'An√≥nimo'}</b></div>
          <div class="faq-answers">
            ${item.answers.map((a, aidx) => {
              let deleteAnswerBtn = '';
              if (currentUser && a.email === currentUser) {
                deleteAnswerBtn = `<button class="delete-btn" data-type="answer" data-idx="${idxGlobal}" data-aidx="${aidx}" title="Eliminar respuesta">&#128465;</button>`;
              }
              return `
                <div class="faq-answer">
                  <div class="faq-answer-meta">
                    <span>Respondido por <b>${a.email ? getNameFromEmail(a.email) : 'An√≥nimo'}</b></span>
                    ${deleteAnswerBtn}
                  </div>
                  ${a.text}
                </div>
              `;
            }).join('')}
          </div>
          <form class="faq-answer-form" data-idx="${idxGlobal}">
            <input type="text" maxlength="300" placeholder="Responder..." required ${!currentUser ? "disabled" : ""}>
            <button type="submit" ${!currentUser ? "disabled" : ""}>Responder</button>
          </form>
        `;
        faqList.appendChild(div);
      });

      // Eliminar pregunta o respuesta
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.onclick = function(e) {
          e.preventDefault();
          const type = this.getAttribute('data-type');
          const idx = parseInt(this.getAttribute('data-idx'));
          const data = getFaqData();
          if (type === "question") {
            if (confirm("¬øSeguro que deseas eliminar esta pregunta y todas sus respuestas?")) {
              data.splice(idx, 1);
              setFaqData(data);
              renderFaq();
            }
          } else if (type === "answer") {
            const aidx = parseInt(this.getAttribute('data-aidx'));
            if (confirm("¬øSeguro que deseas eliminar esta respuesta?")) {
              data[idx].answers.splice(aidx, 1);
              setFaqData(data);
              renderFaq();
            }
          }
        };
      });

      // Formularios de respuesta
      document.querySelectorAll('.faq-answer-form').forEach(form => {
        form.onsubmit = function(e) {
          e.preventDefault();
          const idx = this.getAttribute('data-idx');
          const respuesta = this.querySelector('input[type="text"]').value.trim();
          const currentUser = getCurrentUser();
          let email = currentUser || '';
          if (!respuesta) {
            alert("Por favor, ingresa una respuesta.");
            return;
          }
          if (!email) return; // No deber√≠a pasar por el disabled, pero por seguridad
          const data = getFaqData();
          data[idx].answers.push({ text: respuesta, email: email });
          setFaqData(data);
          renderFaq();
        };
      });

      // Deshabilitar formulario de pregunta si no hay identidad
      document.getElementById('faq-question').disabled = !currentUser;
      document.querySelector('#faq-form button[type="submit"]').disabled = !currentUser;
    }

    // Publicar pregunta
    document.getElementById('faq-form').onsubmit = function(e) {
      e.preventDefault();
      const pregunta = document.getElementById('faq-question').value.trim();
      const currentUser = getCurrentUser();
      let email = currentUser || '';
      if (!pregunta) {
        alert("Por favor, ingresa una pregunta.");
        return;
      }
      if (!email) return; // Seguridad extra, aunque el bot√≥n est√° deshabilitado
      const data = getFaqData();
      data.unshift({ question: pregunta, email: email, answers: [] });
      setFaqData(data);
      document.getElementById('faq-question').value = '';
      renderFaq();
    };

    // Resalta todas las coincidencias y hace scroll a la primera visible
    function highlightAndScrollToMatches(term) {
      if (!term) return;
      const faqList = document.getElementById('faq-list');
      const items = faqList.querySelectorAll('.faq-item');
      let firstMatch = null;

      items.forEach(item => {
        // Quitar resaltado previo
        item.querySelectorAll('.highlight-search').forEach(span => {
          span.outerHTML = span.innerText;
        });

        // Resaltar en pregunta
        const question = item.querySelector('.faq-question-text span');
        if (question && question.innerText.toLowerCase().includes(term.toLowerCase())) {
          highlightText(question, term);
          if (!firstMatch) firstMatch = question;
        }

        // Resaltar en respuestas
        const answers = item.querySelectorAll('.faq-answer');
        answers.forEach(answer => {
          if (answer.innerText.toLowerCase().includes(term.toLowerCase())) {
            highlightText(answer, term);
            if (!firstMatch) firstMatch = answer;
          }
        });
      });

      // Hacer scroll a la primera coincidencia resaltada
      if (firstMatch) {
        // Buscar el contenedor .faq-item m√°s cercano para centrar mejor
        let parentItem = firstMatch.closest('.faq-item');
        if (parentItem) {
          parentItem.scrollIntoView({ behavior: "smooth", block: "center" });
        } else {
          firstMatch.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      }
    }

    // Mant√©n la funci√≥n highlightText igual
    function highlightText(element, term) {
      const regex = new RegExp(`(${term})`, 'gi');
      element.innerHTML = element.innerText.replace(regex, '<span class="highlight-search">$1</span>');
    }

    // Cambia los eventos de b√∫squeda para usar highlightAndScrollToMatches
    document.getElementById('faq-search-btn').onclick = function() {
      searchTerm = document.getElementById('faq-search').value;
      renderFaq();
      setTimeout(() => highlightAndScrollToMatches(searchTerm), 100);
    };
    document.getElementById('faq-search').addEventListener('keyup', function(e) {
      if (e.key === "Enter") {
        searchTerm = this.value;
        renderFaq();
        setTimeout(() => highlightAndScrollToMatches(searchTerm), 100);
      }
    });

    // Inicializar
    renderIdentityBox();
    renderFaq();
  </script>
</body>
</html>